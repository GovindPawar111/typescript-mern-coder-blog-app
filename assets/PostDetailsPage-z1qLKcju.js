import{r as o,u as D,a as O,b as T,j as e,L as U,g as Y,c as F,O as B,M as Q,B as A,T as l,q as C,d as $,e as Z,P as M,f as ee,h as te,i as P,k as se,p as _}from"./index-URDWOw5y.js";import{u as ne,a as ae,b as oe,c as re,C as k}from"./commentQueries-beNjnD8y.js";import{u as le,e as ie,E as de}from"./TextEditor-c5npKfEC.js";import{S as ce}from"./arrow_back-U6SKPAG4.js";const W=a=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-edit",...a},o.createElement("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),o.createElement("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})),R=a=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2",...a},o.createElement("polyline",{points:"3 6 5 6 21 6"}),o.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),o.createElement("line",{x1:10,y1:11,x2:10,y2:17}),o.createElement("line",{x1:14,y1:11,x2:14,y2:17})),me=({postId:a})=>{const[i,d]=o.useState(""),[r,p]=o.useState(""),[x,j]=o.useState(void 0),[f,h]=o.useState(!1),{user:n}=D(),v=O(),{showBoundary:E}=T(),{createNotification:c}=$(),{data:g,isLoading:b,isError:t,error:S}=ne(a),{mutate:u}=ae(),{mutate:I}=oe(),{mutate:V}=re();if(t&&E(S),b||!g)return e.jsx("div",{className:"w-full flex flex-grow",children:e.jsx(U,{})});const q=async(s,m,y,w)=>{if(n!=null&&n.isAnonymous){c("You need to log in as a real user to add comment.",l.Info,1/0);return}u({postId:m,userId:y,author:w,comment:s},{onSuccess:N=>{C.setQueryData([k,m],L=>L?L.concat(N):[N]),c("Successfully Added the comment",l.Success)},onError:()=>{c("Failed to add comment",l.Error)}})},z=async s=>{if(n!=null&&n.isAnonymous){c("You need to log in as a real user to delete comment.",l.Info);return}I(s,{onSuccess:()=>{C.setQueryData([k,a],m=>m?m.filter(y=>y._id!==s):[]),c("Successfully deleted the comment",l.Success)},onError:()=>{c("Failed to delete comment",l.Error)}})},G=async(s,m="")=>{if(n!=null&&n.isAnonymous){c("You need to log in as a real user to edit comment.",l.Info);return}V({commentId:s,updatedComment:m},{onSuccess:y=>{C.setQueryData([k,a],w=>w?[...w.filter(N=>N._id!==s),y]:[]),c("Successfully updated the comment",l.Success)},onError:()=>{c("Failed to update comment",l.Error)}})},H=()=>{!n&&v("/login"),n&&i&&q(i,a,n.id,n.username),d("")},J=(s,m)=>{j(s),p(m)},K=()=>{x&&G(x,r),j("")},X=s=>{z(s)};return e.jsxs("section",{className:"flex flex-col",children:[e.jsx("h3",{className:"mt-6 mb-4 font-semibold",children:"Comments:"}),g.length>0&&g.map(s=>e.jsxs("div",{className:`w-full py-2 px-2 rounded-lg bg-gray-300 my-2 self-end ${n!=null&&n.id&&n.id===s.userId?"bg-gray-100 self-end ":"bg-gray-250 "}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-gray-600",children:`@${s.author}`}),e.jsxs("div",{className:"flex justify-center items-center space-x-4",children:[e.jsx("p",{className:"text-gray-500 text-sm",children:Y(s.updatedAt)}),e.jsx("p",{className:"text-gray-500 text-sm hidden min-[450px]:block",children:F(s.updatedAt)}),(n==null?void 0:n.id)&&n.id===s.userId&&x!==s._id&&e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(W,{onClick:()=>J(s._id,s.comment),className:"cursor-pointer"}),e.jsx(R,{onClick:()=>h(!0),className:"cursor-pointer"}),e.jsx(B,{isOpen:f,onClose:()=>h(!1),children:e.jsx(Q,{headerText:"Are you sure you want to delete this Comment?",description:"This will delete the Comment permanently. You cannot undo this action.",onClose:()=>h(!1),onAction:()=>X(s._id),actionLabel:"Delete"})})]})]})]}),x===s._id?e.jsxs("div",{className:"mt-1 mb-4 sm:m-4 flex flex-col min-[450px]:flex-row",children:[e.jsx("input",{type:"text",placeholder:"Update a comment",className:"flex-grow outline-none px-4 py-2 mt-4 md:mt-0",value:r,onChange:m=>p(m.target.value)}),e.jsxs("div",{className:"flex justify-end min-[450px]:justify-between",children:[e.jsx(A,{label:"Update",className:"mt-4 md:mt-0 ml-2",onClick:K}),e.jsx(A,{label:"Close",className:"mt-4 md:mt-0 ml-2",onClick:()=>j("")})]})]}):e.jsx("p",{className:"px-4 mt-2",children:s.comment})]},s._id)),e.jsxs("div",{className:"w-full flex flex-col mt-4 min-[450px]:flex-row",children:[e.jsx("input",{type:"text",placeholder:"Write a comment",className:"w-full outline-none px-4 py-2 mt-0 border border-gray-300",value:i,onChange:s=>d(s.target.value)}),e.jsx(A,{label:"Add comment",className:"mt-4 min-[450px]:mt-0 w-full min-[450px]:w-[200px]",onClick:H})]})]})},ue=({initialContent:a})=>{const i=le({extensions:ie,editable:!1,content:JSON.parse(a),editorProps:{attributes:{class:"py-2 focus:border-none focus:rounded-none border-none"}}});return o.useEffect(()=>{if(i&&a!==""){const d=JSON.parse(a);i.commands.setContent(d)}},[a]),e.jsx("div",{className:"focus:rounded-none mt-4",children:e.jsx(de,{editor:i})})},xe=()=>{const[a,i]=o.useState(!1),{user:d}=D(),r=Z(),p=O(),{createNotification:x}=$(),{showBoundary:j}=T();if(!r.postId)return;const f=C.getQueryData([M,{search:""}]),h=f==null?void 0:f.find(u=>u._id===r.postId),{data:n,isError:v,error:E,isLoading:c}=ee(r.postId,!h),{mutate:g,isPending:b}=te(r.postId);v&&j(E);const t=h||n,S=async()=>{if(d!=null&&d.isAnonymous){x("You need to log in as a real user to delete a post.",l.Info);return}r.postId&&g(r.postId,{onSuccess:()=>{h&&C.setQueryData([M,{search:""}],f==null?void 0:f.filter(u=>u._id!==r.postId)),x("Post deleted successfully",l.Success),p("/")},onError:()=>{x("Failed to delete the post",l.Error)}})};return c||t===void 0||b?e.jsx("div",{className:"w-full flex flex-grow",children:e.jsx(U,{})}):e.jsx("section",{className:"flex justify-center items-start w-full",children:e.jsxs("div",{className:"w-full py-8 px-4 sm:px-8 lg:w-[90%] min-[1400px]:w-[1240px]",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-2 justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"flex justify-start align-center gap-1",children:[e.jsx(ce,{className:"cursor-pointer w-[32px] h-[24px] mt-[8px]",onClick:()=>p(-1)}),e.jsx("h1",{className:"text-2xl font-bold text-black md:text-3xl",children:t==null?void 0:t.title})]}),(t==null?void 0:t.userId)===(d==null?void 0:d.id)&&e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(P,{to:`/posts/edit/${t==null?void 0:t._id}`,children:e.jsx(W,{})}),e.jsx(R,{className:"cursor-pointer",onClick:()=>i(!0)}),e.jsx(B,{isOpen:a,onClose:()=>i(!1),children:e.jsx(Q,{headerText:"Are you sure you want to delete this post?",description:"This will delete the post permanently. You cannot undo this action.",onClose:()=>i(!1),onAction:()=>S(),actionLabel:"Delete"})})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx(P,{to:`/profile/${t==null?void 0:t.userId}`,state:t==null?void 0:t.username,children:e.jsxs("p",{children:["@",t==null?void 0:t.username]})}),e.jsx("div",{className:"flex space-x-2",children:(t==null?void 0:t.updatedAt)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:Y(t.updatedAt)}),e.jsx("span",{children:F(t.updatedAt)})]})})]}),e.jsx("div",{className:"w-full mx-auto mt-6 rounded-sm",children:(t==null?void 0:t.headerImageUrl)&&e.jsx(se.LazyLoadImage,{alt:t.title,effect:"blur",className:"w-full h-full object-cover cursor-pointer rounded-sm",height:"110%",width:"100%",src:t==null?void 0:t.headerImageUrl,placeholderSrc:_,onErrorCapture:u=>u.currentTarget.src=_})}),e.jsx("p",{className:"mx-auto mt-6",children:t==null?void 0:t.description}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-2 items-start sm:items-center mt-6 font-semibold",children:[e.jsx("p",{children:"Categories:"}),e.jsx("div",{className:"flex justify-start items-start flex-wrap",children:t==null?void 0:t.categories.map((u,I)=>e.jsx("div",{className:"bg-gray-300 rounded-lg px-3 py-1 mr-2 mb-2",children:u},`${u}-${I}`))})]}),(t==null?void 0:t.content)&&e.jsx(ue,{initialContent:(t==null?void 0:t.content)||""}),r.postId&&e.jsx(me,{postId:r.postId})]})})},ge=xe;export{ge as Component,xe as default};
