import{r as w,p as v,u as M,a as _,m as A,j as e,L as D,B as S,S as Y,T as h,q as E,P as B,d as O}from"./index-URDWOw5y.js";import{T as Q}from"./TextEditor-c5npKfEC.js";import{u as V,C as j,t as q}from"./zod-wQOMx4mP.js";import{P as K}from"./postFormType-bINrwK31.js";import{C as J}from"./commentQueries-beNjnD8y.js";import{S as $}from"./arrow_back-U6SKPAG4.js";const z=()=>{const[n,x]=w.useState(""),[i,N]=w.useState({file:null,previewImageURL:v}),{user:r}=M(),b=_(),{createNotification:d}=O(),{mutate:k,isPending:F}=A(),{register:P,handleSubmit:I,setValue:p,getValues:C,formState:{errors:o},control:u,setError:c}=V({defaultValues:{title:"",description:"",categories:[],content:""},resolver:q(K)}),R=()=>{const t=C("categories");if(t&&t.length>=3){x(""),c("categories",{message:"Maximum of 3 categories are allowed"});return}if((t==null?void 0:t.filter(s=>s===n.trim()).length)>0){c("categories",{message:"Duplicate categories are not allowed"});return}t&&p("categories",[...t,n.trim()]),x("")},L=t=>{var a;const s=(a=C("categories"))==null?void 0:a.filter(l=>l!==t);p("categories",s)},U=t=>{const s=t.target,a=s.files[0];N(a?{file:s.files[0],previewImageURL:URL.createObjectURL(a)}:{file:null,previewImageURL:v})},T=async({title:t,description:s,categories:a,content:l})=>{if(r!=null&&r.isAnonymous){d("You need to log in as a real user to create a post.",h.Info);return}const g={title:t,description:s,categories:a,content:l,username:r==null?void 0:r.username,userId:r==null?void 0:r.id},f=new FormData;i.file!==null&&f.append("header-image",i.file,i.file.name),f.append("data",JSON.stringify(g)),k(f,{onSuccess:m=>{E.setQueryData([B,{search:""}],y=>y?[m,...y]:[m]),E.setQueryData([J,m._id],[]),d("Successfully create a new post",h.Success),b(`/posts/${m._id}`)},onError:()=>{d("Failed to create post",h.Error)}})};return F?e.jsx("div",{className:"w-full flex flex-grow",children:e.jsx(D,{label:"Creating New Post..."})}):e.jsx("section",{className:"flex justify-center items-start w-full",children:e.jsxs("div",{className:"w-full py-8 px-4 sm:px-8 lg:w-[90%] min-[1400px]:w-[1240px]",children:[e.jsxs("div",{className:"flex justify-start align-center gap-1",children:[e.jsx($,{className:"cursor-pointer w-[32px] h-[24px] mt-[3px] md:mt-[5px]",onClick:()=>b(-1)}),e.jsx("h1",{className:"font-bold text-xl md:text-2xl",children:"Create a post"})]}),e.jsxs("form",{noValidate:!0,className:"w-full flex flex-col mt-4",onSubmit:I(T),children:[e.jsx("input",{type:"text",placeholder:"Enter post title",className:"px-4 py-2 text-black border-2 focus:border-black",...P("title")}),o.title&&e.jsx("label",{htmlFor:"title",className:"text-red-500 text-xs",children:o.title.message}),e.jsx(j,{name:"description",control:u,render:({field:t})=>e.jsx("textarea",{id:"description",...t,placeholder:"Enter post description",className:"px-4 py-2 text-black border-2 focus:border-black mt-4"})}),o.description&&e.jsx("label",{htmlFor:"description",className:"text-red-500 text-xs",children:o.description.message}),e.jsx("img",{src:i.previewImageURL,alt:"title",className:"w-[250px] h-[150px] object-cover cursor-pointer mt-4"}),e.jsx("input",{type:"file",className:"px-4 w-[300px] mt-4",accept:"image/*",onChange:t=>U(t)}),e.jsx("div",{className:"flex flex-col mt-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",placeholder:"Enter post categories",className:"px-4 py-2 mr-2 sm:mr-4 text-black border-2 focus:border-black",value:n,onChange:t=>x(t.target.value),onFocus:()=>{var t;(t=o.categories)!=null&&t.message&&c("categories",{message:""})}}),e.jsx(S,{label:"Add",onClick:()=>{n.trim()&&R()}})]})}),e.jsx(j,{name:"categories",control:u,render:({field:t})=>{var s;return e.jsx("div",{className:"flex flex-wrap",children:(s=t.value)==null?void 0:s.map((a,l)=>{const g=a+l+Date.now()+Math.random();return e.jsxs("div",{className:"flex justify-center items-center space-x-2 m-2 bg-gray-200 px-2 py-1 rounded",children:[e.jsx("span",{children:a}),e.jsx("span",{className:"text-black p-1 cursor-pointer text-sm",onClick:()=>L(a),children:e.jsx(Y,{})})]},g)})})}}),o.categories&&e.jsx("label",{htmlFor:"categories",className:"text-red-500 text-xs",children:o.categories.message}),e.jsx("div",{className:"mt-4",children:e.jsx(j,{control:u,name:"content",render:({field:t})=>e.jsx(Q,{initialContent:"",onChange:s=>t.onChange(s),onEmpty:s=>{s&&(p("content",""),c("content",{message:"Content is required"}),t.onBlur())}})})}),o.content&&e.jsx("label",{htmlFor:"content",className:"text-red-500 text-xs",children:o.content.message}),e.jsx(S,{type:"submit",label:"Create",className:"w-[200px] mx-auto text-lg md:text-xl mt-4"})]})]})})},te=z;export{te as Component,z as default};
